version: 2
jobs:
  build:
    docker:
      - image: circleci/node
    steps:
      - checkout
      parameters:
        project:
          description: Which project to build docker image for.
          type: string
          default: dev
      - run: |
          docker build -t blackstockc/<< parameters.name >> ./<< parameters.dir >>
  test:
    docker:
      - image: circleci/node
    steps:
      - checkout
      - setup_remote_docker
      - run: |
          docker build -t blackstockc/react-test -f ./projects/client/Dockerfile.dev ./projects/client
          docker run blackstockc/react-test npm test -- --coverage

workflows:
  version: 2
  build_and_test:
    jobs:
      - test

  - docker build -t blackstockc/multi-client ./projects/client
  - docker build -t blackstockc/multi-nginx ./nginx
  - docker build -t blackstockc/multi-server ./projects/server
  - docker build -t blackstockc/multi-worker ./projects/worker